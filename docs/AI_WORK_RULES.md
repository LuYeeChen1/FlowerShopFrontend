# AI_WORK_RULES.md
# Codex 通用工作规则（Code Quality First）

> 核心立场：**允许、鼓励把一个任务拆成很多小任务**，只要这能显著提升代码质量。
> 拆分数量不受限制，质量是唯一 KPI。

---

## 0) 最高优先级（不可违背）

1. **Code Quality > Delivery Speed > File Count**
2. 正确性（Correctness）高于一切  
3. 可读性（Readability）与可维护性（Maintainability）必须长期成立  
4. **严禁为了“少步骤 / 少文件 / 看起来快”而压缩设计**

---

## 1) 任务拆分原则（强制）

### 1.1 拆分是默认行为（不是例外）
- **一个“大任务”必须拆成多个小任务（Feature Slice）**
- 拆分数量 **不设上限**
- 只要拆分能提升以下任意一点，就必须拆：
  - 职责清晰度
  - 边界可读性
  - 测试可行性
  - 未来修改安全性

👉 **Codex 不得因为任务“看起来简单”而拒绝拆分**

---

### 1.2 什么是一个合格的 Feature Slice
一个 Slice 必须满足：
- 职责单一（只做一件事）
- 改动范围可控
- 可以独立验证
- 不依赖“未来再补”

---

## 2) 允许行为（明确授权）

Codex **被明确允许**：
- 将 1 个需求拆成 5～20 个小 Slice
- 新增必要的文件 / 类 / 接口
- 先写结构，再补实现
- 为了清晰而显得“啰嗦”

只要结果是：
> **长期更安全、更易读、更易改**

---

## 3) 严禁行为（高风险）

❌ 为了快而合并职责  
❌ 为了少文件而写“万能类 / 万能函数”  
❌ 写“先能跑，之后再重构”的代码  
❌ 留 TODO / FIXME 作为设计的一部分  
❌ 引入未使用或“可能以后用”的代码  

---

## 4) 实现层级规则（通用）

- 不同层的职责必须物理隔离（不同目录 / 包）
- 高层不得依赖低层实现细节
- 不跨层偷懒调用
- 业务逻辑 **不得** 出现在 Controller / UI / Adapter

---

## 5) 验证与完成标准

一个 Slice **只有在以下全部成立时才算完成**：
- 代码可独立阅读（不需要“你看上下文就懂”）
- 有最小验证方式（测试 / 调用方式 / 运行说明）
- 没有隐藏前提条件
- 删除任何一行都会让代码变差（没有冗余）

---

## 6) 决策冲突时的取舍顺序

当出现冲突，按以下顺序取舍：
1. Correctness
2. Clarity
3. Explicitness
4. Consistency
5. Performance
6. Brevity（最不重要）

---

## 7) 最终铁律（必须记住）

> **“多做几步”是被鼓励的，  
> “少想一步”是不可接受的。**

Codex 必须假设：
- 代码会被别人长期维护
- 维护者不会读你的对话
- 只有代码本身能说明一切
